<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>G4 -Ajuntament de Calp-Visor Urbanismo</title>

  <style>
    html,
    body {
      padding: 0;
      margin: 0;
      height: 100%;

    }
  </style>
  <link rel="icon" type="image/png" href="images/EscudoCalp.ico">

  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://js.arcgis.com/4.10/esri/css/main.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://js.arcgis.com/4.10/"></script>


</head>

<body>
  <div id="view1Div" style="float: left; width: 50%; height: 100%;"></div>
  <div id="view2Div" style="float: left; width: 50%; height: 100%;"></div>
  <div class="barraPrincipal">
    <a href="https://www.calp.es/es/territorio" target="_blank"><img class="logoAyuntamiento" src="images/logoCalp.png"></img></a>
    <p class="tituloPrincipal">VISOR URBANISMO 3D-2D</p>
  </div>

  <!-- Este div es para crear el contenedor donde irÃ¡n los iconos que filtren -->
  <div class="contenedorBotones">
    <div id="botonAccionOcio" class="botonOcio">
      <div class="w3-button w3-circle w3-khaki" aria-label="Ocio" title="Ocio"><i class="fas fa-glass-cheers" style="font-size:20px;color:rgb(122, 153, 172);"></i></div>
    </div>
    <div id="botonAccionTurismos" class="botonTurismos">
      <div class="w3-button w3-circle w3-khaki" aria-label="Turismos" title="Turismos"><i class="fas fa-car" style="font-size:22px;color:rgb(122, 153, 172);"></i></div>
    </div>
    <div id="botonAccionServicios" class="botonServicios">
      <div class="w3-button w3-circle w3-khaki" aria-label="Servicios" title="Servicios"><i class="fab fa-speakap" style="font-size:26px;color:rgb(122, 153, 172);"></i></div>
    </div>
    <div id="botonAccionAlojamiento" class="botonAlojamiento">
      <div class="w3-button w3-circle w3-khaki" aria-label="Alojamientos" title="Alojamientos"><i class="material-icons" style="font-size:24px;color:rgb(122, 153, 172);">hotel</i></div>
    </div>
    <div id="botonAccionRestaurantes" class="botonRestaurantes">
      <div class="w3-button w3-circle w3-khaki" aria-label="Restaurantes" title="Restaurantes"><i class="material-icons" style="font-size:24px;color:rgb(122, 153, 172);">restaurant</i></div>
    </div>
  </div>

  <script>
    require([
      "esri/WebMap",
      "esri/WebScene",
      "esri/views/MapView",
      "esri/views/SceneView",
      "esri/core/watchUtils",
      "esri/widgets/Legend"

    ], function(
      WebMap,
      WebScene,
      MapView, SceneView,
      watchUtils,
      Legend
    ) {

      var webmap = new WebMap({
        portalItem: {
          id: "0ca818c1674e4403937ef94e0e196c0d"
        }
      });

      var webscene = new WebScene({
        portalItem: {
          id: "bba7fb45bfa149d69695ec5762a7f317"
        }
      });

      var view1 = new SceneView({
        id: 'view1',
        container: 'view1Div',
        map: webscene
      });

      var view2 = new MapView({
        id: 'view2',
        container: 'view2Div',
        map: webmap,
        constraints: {
          // Disable zoom snapping to get the best synchonization
          snapToZoom: false
        }
      });

      view1.when(function() {
        capa3D = webscene.findLayerById('1695d04df21-layer-1');
        capa2D = webmap.findLayerById('PuntosCalp_Grupos_9989');



        var ocioDOM = document.getElementById('botonAccionOcio');
        ocioDOM.onclick = function() {
          capa2D.definitionExpression = "Grupo = 'Ocio'";
          capa3D.definitionExpression = "Grupo = 'Ocio'";
        };

        var turismoDOM = document.getElementById('botonAccionTurismos');
        turismoDOM.onclick = function() {
          capa2D.definitionExpression = "Grupo = 'Turismos'";
          capa3D.definitionExpression = "Grupo = 'Turismos'";
        };

        var serviciosDOM = document.getElementById('botonAccionServicios');
        serviciosDOM.onclick = function() {
          capa2D.definitionExpression = "Grupo = 'Servicios'";
          capa3D.definitionExpression = "Grupo = 'Servicios'";
        };

        var alojamientoDOM = document.getElementById('botonAccionAlojamiento');
        alojamientoDOM.onclick = function() {
          capa2D.definitionExpression = "Grupo = 'Alojamiento'";
          capa3D.definitionExpression = "Grupo = 'Alojamiento'";
        };

        var restaurantesDOM = document.getElementById('botonAccionRestaurantes');
        restaurantesDOM.onclick = function() {
          capa2D.definitionExpression = "Grupo = 'Restaurantes'";
          capa3D.definitionExpression = "Grupo = 'Restaurantes'";
        };


        var leyenda = new Legend({
          view: view2
        });
        view2.ui.add(leyenda);

      });



      var synchronizeView = function(view, others) {
        others = Array.isArray(others) ? others : [others];

        var viewpointWatchHandle;
        var viewStationaryHandle;
        var otherInteractHandlers;
        var scheduleId;

        var clear = function() {
          if (otherInteractHandlers) {
            otherInteractHandlers.forEach(function(handle) {
              handle.remove();
            });
          }
          viewpointWatchHandle && viewpointWatchHandle.remove();
          viewStationaryHandle && viewStationaryHandle.remove();
          scheduleId && clearTimeout(scheduleId);
          otherInteractHandlers = viewpointWatchHandle =
            viewStationaryHandle = scheduleId = null;
        };

        var interactWatcher = view.watch('interacting,animation',
          function(newValue) {
            if (!newValue) {
              return;
            }
            if (viewpointWatchHandle || scheduleId) {
              return;
            }

            // start updating the other views at the next frame
            scheduleId = setTimeout(function() {
              scheduleId = null;
              viewpointWatchHandle = view.watch('viewpoint',
                function(newValue) {
                  others.forEach(function(otherView) {
                    otherView.viewpoint = newValue;
                  });
                });
            }, 0);

            // stop as soon as another view starts interacting, like if the user starts panning
            otherInteractHandlers = others.map(function(otherView) {
              return watchUtils.watch(otherView,
                'interacting,animation',
                function(
                  value) {
                  if (value) {
                    clear();
                  }
                });
            });

            // or stop when the view is stationary again
            viewStationaryHandle = watchUtils.whenTrue(view,
              'stationary', clear);
          });

        return {
          remove: function() {
            this.remove = function() {};
            clear();
            interactWatcher.remove();
          }
        }
      };

      /**
       * utility method that synchronizes the viewpoints of multiple views
       */
      var synchronizeViews = function(views) {
        var handles = views.map(function(view, idx, views) {
          var others = views.concat();
          others.splice(idx, 1);
          return synchronizeView(view, others);
        });

        return {
          remove: function() {
            this.remove = function() {};
            handles.forEach(function(h) {
              h.remove();
            });
            handles = null;
          }
        }
      }

      // bind the views
      synchronizeViews([view1, view2]);

    });
  </script>



</body>

</html>
